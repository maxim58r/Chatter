# values.yaml

# Общие настройки Kibana
kibana:
  # Подключение к Elasticsearch
  elasticsearchHosts: "http://elasticsearch-master.logging.svc.cluster.local:9200" # Внутренний DNS Kubernetes
  elasticsearchUsername: "kibana_system"
  elasticsearchPassword: "your-kibana-system-password"
  elasticsearchTLS:
    enabled: true
    autoGenerated: true

  # Настройка безопасности
  security:
    enabled: true
    tls:
      enabled: true
      autoGenerated: true

  # Конфигурация Kibana
  config:
    xpack:
      security:
        authc:
          providers:
            oidc:
              oidc1:
                order: 0
                realm: "oidc1"
                rp:
                  client_id: "myKeycloakClientId"
                  client_secret: "${xpack.security.authc.providers.oidc.oidc1.rp.client_secret}"
                  redirect_uri: "https://192.168.1.35/login/oidc/callback"
                  post_logout_redirect_uri: "https://192.168.1.35/"
                op:
                  issuer: "http://192.168.1.35:32080/realms/Chatter"
                claims:
                  principal: sub
                  groups: groups
                authentication:
                  request:
                    response_mode: form_post
                logout:
                  type: backchannel
        role_mapping:
          oidc_mapping:
            roles:
              - "admin"
            rules:
              field:
                groups: "admin-group"

      encryptionKey: "568PJpfrh1BgK4j7d8t2Tk9H/oa/x3xvucOe4cgUd9E=" # Замените на случайную строку (например, 32 символа)
      reporting:
        encryptionKey: "L/Z2YhKd1WRTWws6LmIEkymGdg4Cl+b/C5ZS5L9OVDY=" # Замените на случайную строку (например, 32 символа)
        kibanaServer:
          hostname: "localhost" # Убедитесь, что это соответствует вашему домену или localhost
      encryptedSavedObjects:
        encryptionKey: "C8s7XMvoyO8zJITGrpSUnecKUq25CP97S4goJmt2dDg=" # Замените на случайную строку (например, 32 символа)

  # Настройка keystore для хранения секретов
  keystoreSecrets:
    - name: kibana-keystore
      entries:
        - key: xpack.security.authc.providers.oidc.oidc1.rp.client_secret
          valueFrom:
            secretKeyRef:
              name: kibana-oidc-client-secret
              key: client-secret

# Настройка секретов для OIDC
secrets:
  kibana-oidc-client-secret:
    client-secret: "Y0PZTBYI8XTNRQ8XIfoj9ZmcTVlFbIdG" # Замените на реальный client_secret из Keycloak

# Настройка сервисов и ингрессов
service:
  type: ClusterIP
  annotations: {}
  ports:
    http: 5601

ingress:
  enabled: true
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: kibana-tls
      hosts:
        - ""

# Ресурсы и масштабирование
resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "2Gi"

replicas: 1