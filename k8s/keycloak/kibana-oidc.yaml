replicaCount: 1

##########################################################
# Подключаемся к ES по HTTPS
##########################################################
elasticsearchHosts: "https://elasticsearch-master:9200"

elasticsearch:
  username: "kibana_system"
  password: "dRwff7gKMCTzvOKOYY4S"

service:
  type: NodePort
  port: 5601
  nodePort: 30081  # наружный порт, если нужно внешнее подключение

##########################################################
# Конфигурация kibana.yml
##########################################################
kibanaConfig:
  kibana.yml: |
    server.publicBaseUrl: "https://kibana.chatter.com"

    elasticsearch.ssl.certificateAuthorities: /usr/share/kibana/config/certs/ca.crt
    elasticsearch.ssl.verificationMode: full

    xpack.security.authc.providers:
      basic.basic1:
        order: 0
      oidc.oidc1:
        order: 1
        realm: "oidc1"

    xpack.security.authc.oidc.oidc1:
      realm: "oidc1"
      client_id: "kibana-client"
      client_secret: "sAcCHLav7Q891svS8SmE27KLFNL2hwvr"
      authorization_endpoint: "https://keycloak.chatter.com/realms/Chatter/protocol/openid-connect/auth"
      token_endpoint: "https://keycloak.chatter.com/realms/Chatter/protocol/openid-connect/token"
      userinfo_endpoint: "https://keycloak.chatter.com/realms/Chatter/protocol/openid-connect/userinfo"
      jwkset_path: "https://keycloak.chatter.com/realms/Chatter/protocol/openid-connect/certs"
      logout_endpoint: "https://keycloak.chatter.com/realms/Chatter/protocol/openid-connect/logout"
      redirect_uri: "https://kibana.chatter.com/api/security/oidc/callback"

resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "1Gi"

########################################################################
# Включаем pre-install Token Creation (по умолчанию включён),
# и разрешаем чарту сам монтировать CA (или сделаем вручную).
########################################################################
preInstallTokenCreation:
  enabled: false
  automountElasticsearchCerts: true
