elasticsearch:
  security:
    enabled: true
    tls:
      enabled: true
      autoGenerated: true  # Автоматически сгенерированный сертификат
  keystoreSecrets:
    - name: elasticsearch-keystore
      entries:
        - key: xpack.security.authc.realms.oidc.oidc1.rp.client_secret
          valueFrom:
            secretKeyRef:
              name: oidc-client-secret
              key: client-secret
  config:
    cluster.name: "elasticsearch"  # Исправлено имя кластера
    network.host: 0.0.0.0
    discovery:
      type: single-node
      seed_hosts: []  # Убрано seed_hosts
    xpack:
      security:
        enabled: true
        http.ssl.enabled: true
        transport.ssl.enabled: true
        authc:
          realms:
            native:
              native1:
                order: 0   # Для встроенных пользователей (elastic) используем native (reserved) realm
            oidc:
              oidc1:
                order: 10  # OIDC realm для остальных пользователей
                rp:
                  client_id: "myKeycloakClientId"  # ID клиента в Keycloak
                  client_secret: "${xpack.security.authc.realms.oidc.oidc1.rp.client_secret}"  # Ссылка на секрет
                  redirect_uri: "https://elasticsearch.chatter.com/api/security/v1/oidc"
                  post_logout_redirect_uri: "https://elasticsearch.chatter.com/"
                op:
                  issuer: "http://192.168.1.35:32080/realms/Chatter"  # URL Keycloak реалма
                claims:
                  principal: sub
                  groups: groups
                authentication:
                  request:
                    response_mode: form_post
                logout:
                  type: backchannel
        role_mapping:
          oidc_mapping:
            roles:
              - "admin"
            rules:
              field:
                groups: "admin-group"  # Группа в Keycloak для маппинга на роль admin
  master:
    readinessProbe:
      enabled: true
      httpGet:
        path: /
        port: 9200
        scheme: HTTPS
      initialDelaySeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
      periodSeconds: 10
      successThreshold: 1
      headers:
        - name: "Authorization"
          value: "Basic ZWxhc3RpYzpTaUZpVFR1cFNIaHExNEdaWlxiVFM="  # Base64 учетных данных elastic
  secrets:
    oidc-client-secret:
      client-secret: "Y0PZTBYI8XTNRQ8XIfoj9ZmcTVlFbIdG"  # Используйте реальный client_secret из Keycloak
  service:
    type: ClusterIP
    ports:
      http: 9200
      transport: 9300
  ingress:
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    hosts:
      - host: "elasticsearch.chatter.com"
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
          - "elasticsearch.chatter.com"
  resources:
    requests:
      cpu: "1"
      memory: "2Gi"  # Увеличено значение памяти
    limits:
      cpu: "2"
      memory: "4Gi"  # Увеличено значение памяти
  replicas: 1