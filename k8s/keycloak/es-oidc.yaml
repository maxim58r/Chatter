# Репликация
replicas: 1
minimumMasterNodes: 1

# Настройки безопасности
#security:
#  enabled: true
#  tls:
#    enabled: false
#    autoGenerated: true  # Автоматически сгенерированный сертификат

# Использование keystore для импорта client_secret
#keystore:
#  - secretName: oidc-client-secret
#    items:
#      - key: client-secret
#        path: xpack.security.authc.realms.oidc.oidc1.rp.client_secret

#extraEnvs:
#  - name: ELASTIC_PASSWORD
#    value: "QJaWS1Bi7ULkaWfJc*Hi"
#  - name: cluster.initial_master_nodes
#    value: ""


#protocol: http

esConfig:
  elasticsearch.yml: |
    #cluster.name: "elasticsearch"
    #node.name: "elasticsearch-master-0"
    
    # Режим одиночного узла
    #network.host: 0.0.0.0
    #discovery.type: single-node
    #node.roles: ["master", "data", "ingest"]
    #cluster.initial_master_nodes: []

    # Безопасность
    xpack.security.enabled: false
    xpack.security.http.ssl.enabled: false
    xpack.security.transport.ssl.enabled: false
    #xpack.security.transport.ssl.verification_mode: certificate
    
    # Рекомендуемые дополнительные параметры для безопасности
    xpack.security.authc.token.enabled: true
    xpack.security.authc.api_key.enabled: true
    xpack.security.enrollment.enabled: true
    
    # Realm для встроенных пользователей
    xpack.security.authc.realms.native.native1.order: 0
    
    # OIDC realm для внешних пользователей
    xpack.security.authc.realms.oidc.oidc1.order: 10
    xpack.security.authc.realms.oidc.oidc1.rp.client_id: "myKeycloakClientId"  
    xpack.security.authc.realms.oidc.oidc1.rp.response_type: "code"  
    xpack.security.authc.realms.oidc.oidc1.rp.redirect_uri: "https://elasticsearch.chatter.com/api/security/v1/oidc"
    xpack.security.authc.realms.oidc.oidc1.rp.post_logout_redirect_uri: "https://elasticsearch.chatter.com/"
    xpack.security.authc.realms.oidc.oidc1.op.authorization_endpoint: "https://192.168.1.35:32080/realms/Chatter/protocol/openid-connect/auth"
    xpack.security.authc.realms.oidc.oidc1.op.issuer: "https://192.168.1.35:32080/realms/Chatter"  
    xpack.security.authc.realms.oidc.oidc1.op.jwkset_path: "https://192.168.1.35:32080/realms/Chatter/protocol/openid-connect/certs"
    xpack.security.authc.realms.oidc.oidc1.op.token_endpoint: "https://192.168.1.35:32080/realms/Chatter/protocol/openid-connect/token"
    xpack.security.authc.realms.oidc.oidc1.claims.principal: sub
    #xpack.security.authc.realms.oidc.oidc1.claims.groups: groups

# Ingress configuration
#ingress:
#  enabled: true
#  annotations:
#    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
#  hosts:
#    - host: "elasticsearch.chatter.com"
#      paths:
#        - path: /
#          pathType: Prefix
#  tls:
#    - hosts:
#        - "elasticsearch.chatter.com"

volumeClaimTemplate:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 1Gi

# Resource limits and requests
resources:
  requests:
    cpu: "1"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "1Gi"